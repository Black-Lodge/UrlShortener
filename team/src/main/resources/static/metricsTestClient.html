<!DOCTYPE HTML>
<html>
   <head>
	   <script
           src="https://code.jquery.com/jquery-2.2.4.min.js"
           integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
           crossorigin="anonymous"></script>
      <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

      <script type="text/javascript">
        // Funcion to conect and replenish data to be used in google charts

         var ws = null;
         function WebSocketTest()
         {
            if (ws == null){


            if ("WebSocket" in window)
            {
              
               
               // Let us open a web socket

               var ws = new WebSocket("ws://localhost:8025/globalinformation/globalinformation");
				
               ws.onopen = function()
               {
                  // Web Socket is connected
               };
				
               ws.onmessage = function (evt) 
               { 
                  var received_msg = jQuery.parseJSON(evt.data);
                   $("#time").text(received_msg.time);
                   $("#users").text(received_msg.users);
                   $("#uris").text(received_msg.uris);
                   $("#clicks").text(received_msg.clicks);
                   $("#lastRedirection").text(received_msg.lastRedirection);
                   $("#lastPetition").text(received_msg.lastPetition);
                   $("#used").text(received_msg.used);
                   $("#avaible").text(received_msg.avaible);

                   //Add the the new information to the array of memory
                   if (arrayMemmory.length < 20){
                     arrayMemmory.push([new Date(),received_msg.used,received_msg.avaible]);
                   }else{
                      arrayMemmory.splice(1, 1);
                       arrayMemmory.push([new Date(),received_msg.used,received_msg.avaible]);
                   }
                 
                  

                   //Re-paint charts
                   drawChart();
               };
				
               ws.onclose = function()
               { 
                  // websocket is closed.
                  alert("Connection is closed..."); 
               };
					
               window.onbeforeunload = function(event) {
                  socket.close();
               };

            }
            
            else
            {
               // The browser doesn't support WebSocket
               alert("WebSocket NOT supported by your Browser!");
            }
            }
         }


        // START - GOOGLE STEPPED AREA CHART FOR MEMMORY USED & AVAIBLE
        //variables that websockets must replenish
      
        var arrayMemmory = [  ['Time',  'Used', 'Avaible']];

      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChart);
      
      function drawChart() {
        var data = google.visualization.arrayToDataTable(arrayMemmory);

        var options = {
          title: 'Memoria del sistema',
          vAxis: {title: 'MegaBytes'},
          isStacked: true
        };

        var chart = new google.visualization.SteppedAreaChart(document.getElementById('chart_div'));

        chart.draw(data, options);
      }
        // END - GOOGLE STEPPED AREA CHART FOR MEMMORY USED & AVAIBLE
      </script>
		  
   </head>
   <body>
   
      <div id="sse">
         <a href="javascript:WebSocketTest()">Connect WebSocket</a>
      </div>
      
      <div>
        <p>Tiempo en funcionamiento del servidor: <span id="time"></span>.</p>
        <p>Accesos de usuarios con distinta Ip: <span id="users"></span>.</p>
        <p>Total de Uris almacenadas:  <span id="uris"></span>. </p>
        <p>Clicks totales: <span id="clicks"></span>.</p>
        <p>Tiempo ultima redireccion: <span id="lastRedirection"></span>.</p>
        <p>Tiempo ultima peticion: <span id="lastPetition"></span>.</p>
        <p>Memoria usada <span id="used"></span>.</p>
        <p>Memoria disponible: <span id="avaible"></span>.</p>
        <div id="chart_div" style="width: 900px; height: 500px;"></div>

      </div>
   </body>
</html>